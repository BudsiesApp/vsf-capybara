<template>
  <div
    class="sf-checkbox"
    :class="{
      'sf-checkbox--is-active': isChecked,
      'sf-checkbox--is-disabled': disabled,
      'sf-checkbox--has-error': !valid,
    }"
  >
    <label class="sf-checkbox__container" :for="inputId">
      <input
        v-focus
        type="checkbox"
        :id="inputId"
        :name="name"
        :value="value"
        :checked="isChecked"
        :disabled="disabled"
        class="sf-checkbox__input"
        @change="inputHandler"
      >
      <!-- @slot Custom check mark markup -->
      <slot name="checkmark" v-bind="{ isChecked, disabled }">
        <div
          class="sf-checkbox__checkmark"
          :class="{ 'sf-checkbox__checkmark--is-active': isChecked }"
        >
          <SfIcon v-show="isChecked" icon="check" size="12x" color="white" />
        </div>
      </slot>
      <!-- @slot Custom label markup -->
      <slot name="label" v-bind="{ label, isChecked, disabled }">
        <div v-show="label" class="sf-checkbox__label">{{ label }}</div>
      </slot>
    </label>
  </div>
</template>
<script>

import { SfIcon } from '@storefront-ui/vue';
import { focus } from '@storefront-ui/vue/src/utilities/directives';

let instanceId = 0;
export default {
  name: 'MCheckbox',
  directives: {
    focus
  },
  components: {
    SfIcon
  },
  model: {
    prop: 'selected',
    event: 'change'
  },
  props: {
    name: {
      type: String,
      default: ''
    },
    value: {
      type: [String, Boolean, Object, Number],
      default: ''
    },
    label: {
      type: String,
      default: ''
    },
    required: {
      type: Boolean,
      default: false
    },
    disabled: {
      type: Boolean,
      default: false
    },
    valid: {
      type: Boolean,
      default: true
    },
    selected: {
      type: [Array, Boolean],
      default: () => []
    }
  },
  data () {
    return {
      instanceId: ''
    };
  },
  computed: {
    inputId () {
      return `m-checkbox-${this.instanceId}`;
    },
    isChecked () {
      if (typeof this.selected === 'boolean') {
        return this.selected;
      } else {
        return this.selected.includes(this.value);
      }
    }
  },
  methods: {
    inputHandler () {
      if (typeof this.selected === 'boolean') {
        this.$emit('change', !this.selected);
      } else {
        let selected = [...this.selected];
        if (selected.includes(this.value)) {
          selected = selected.filter((value) => value !== this.value);
        } else {
          selected.push(this.value);
        }
        this.$emit('change', selected);
      }
    }
  },
  created () {
    this.instanceId = instanceId.toString();

    instanceId += 1;
  }
};
</script>
<style lang="scss">
// This component is a replacement for SfCheckbox and we are trying to use the same classes to
// make it look similar. Storefront-UI components are responsible for importing corresponding styles.
// So we are doing the same here.
@import "~@storefront-ui/shared/styles/components/atoms/SfCheckbox.scss";
</style>
